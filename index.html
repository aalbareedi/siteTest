<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="normalize.css" />
        <link rel="stylesheet" href="carousel/carousel.css" />
        <link rel="stylesheet" href="style.css" />
        <title>Stocks</title>
        <!-- google fonts used -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Kanit:wght@300&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Changa&display=swap"
            rel="stylesheet"
        />
        <!-- font awesome -->
        <script
            src="https://kit.fontawesome.com/c82a5882c2.js"
            crossorigin="anonymous"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/css-typed-om@0.4.0/index.umd.min.js"></script>
    </head>
    <body>
        <header>
            <div class="nav-logo">
                <div class="nav-company-image">
                    <i class="fa-solid fa-globe"></i>
                </div>
                <div class="nav-company-name">
                    <div class="nav-company-main-name">Uni-Fi</div>
                    <div class="nav-company-sub-name">Unified Finance</div>
                </div>
            </div>
            <button class="nav-menu-btn" type="button">
                <i class="fa-solid fa-gear settings-nav-btn-icon"></i>
                <i class="fas fa-times close-nav-btn-icon"></i>
                <div class="nav-menu-btn-text">Settings</div>
            </button>
        </header>
        <main id="main-content">
            <nav class="main-dock">
                <button
                    id="stocks-dock-btn"
                    class="main-dock-btn"
                    type="button"
                >
                    <i class="fa-solid fa-arrow-trend-up"></i>
                    <div class="main-dock-btn-text">Stocks</div>
                </button>
                <button
                    id="crypto-dock-btn"
                    class="main-dock-btn dock-btn-selected"
                    type="button"
                >
                    <i class="fab fa-bitcoin"></i>
                    <div class="main-dock-btn-text">Crypto</div>
                </button>
            </nav>
            <div id="crypto">
                <h1 class="main-title">Cryptocurrency</h1>
                <div class="main-stats-wrapper">
                    <!-- <div>Global:</div> -->
                    <div class="main-crypto-stats carousel-wrapper">
                        <div class="carousel">
                            <div class="crypto-stat-group">
                                <div class="crypto-stat-label">
                                    Global Market Cap:
                                </div>
                                <div class="crypto-stat-result global-mcap">
                                    <div class="crypto-stat-value"></div>
                                    <div
                                        class="crypto-stat-perc global-positive"
                                    >
                                        <i class="fas fa-caret-up"></i>
                                        <div class="crypto-stat-perc-val"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="crypto-stat-group">
                                <div class="crypto-stat-label">24h Vol:</div>
                                <div class="crypto-stat-result global-vol">
                                    <div class="crypto-stat-value">$31.17B</div>
                                    <div
                                        class="crypto-stat-perc global-positive"
                                    >
                                        <i class="fas fa-caret-up"></i>
                                        <div class="crypto-stat-perc-val">
                                            5.82%
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="crypto-stat-group">
                                <div class="crypto-stat-label">Dominance:</div>
                                <div class="crypto-stat-result">
                                    <div class="crypto-dom-val btc-dom">
                                        BTC <span>48.8%</span>
                                    </div>
                                    <div class="crypto-dom-val eth-dom">
                                        ETH <span>18.7%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="crypto-pause-btn pause-btn">
                        <i class="fas fa-pause pause-icon"></i>
                        <i class="fas fa-play play-icon"></i>
                    </button>
                </div>
                <script type="module">
                    import { getCryptoGlobalMetrics } from "./api/crypto.js";
                    import {
                        formatUsd,
                        formatPercent,
                    } from "./utils/data-formatter.js";
                    import {
                        makeCarouselWork,
                        makePauseButtonWork,
                    } from "./carousel/carousel.js";

                    const data = await getCryptoGlobalMetrics();

                    makeCarouselWork(
                        document.querySelector(".main-crypto-stats .carousel")
                    );

                    makePauseButtonWork(
                        document.querySelector(
                            ".main-stats-wrapper .pause-btn"
                        ),
                        document.querySelector(".main-crypto-stats .carousel")
                    );

                    const carousels = document.querySelectorAll(
                        ".main-crypto-stats .carousel"
                    );

                    carousels.forEach((carousel) => {
                        renderGlobalStat(
                            carousel.querySelector(
                                ".global-mcap .crypto-stat-value"
                            ),
                            carousel.querySelector(
                                ".global-mcap .crypto-stat-perc"
                            ),
                            data.quote.USD.total_market_cap,
                            data.quote.USD
                                .total_market_cap_yesterday_percentage_change
                        );

                        renderGlobalStat(
                            carousel.querySelector(
                                ".global-vol .crypto-stat-value"
                            ),
                            carousel.querySelector(
                                ".global-vol .crypto-stat-perc"
                            ),
                            data.quote.USD.total_volume_24h,
                            data.quote.USD
                                .total_volume_24h_yesterday_percentage_change
                        );

                        function renderGlobalStat(
                            valElement,
                            percElement,
                            value,
                            perc
                        ) {
                            valElement.innerHTML = formatUsd(value);

                            percElement.querySelector(
                                ".crypto-stat-perc-val"
                            ).innerHTML = formatPercent(perc / 100);

                            percElement.classList.toggle(
                                "global-positive",
                                perc >= 0
                            );

                            percElement.classList.toggle(
                                "global-negative",
                                perc < 0
                            );
                        }
                        carousel.querySelector(".btc-dom span").innerHTML =
                            formatPercent(data.btc_dominance / 100);
                        carousel.querySelector(".eth-dom span").innerHTML =
                            formatPercent(data.eth_dominance / 100);
                    });
                </script>

                <div class="crypto-options">
                    <div class="crypto-tabs">
                        <div class="crypto-tab selected-crypto-tab">
                            Markets
                        </div>
                        <div class="crypto-tab">Watchlist</div>
                    </div>
                    <div class="crypto-controls">
                        <div
                            class="crypto-control-btn"
                            id="crypto-quantity-select"
                        >
                            <div class="crypto-control-btn-text"></div>
                            <div class="crypto-control-arrow">
                                <i class="fas fa-angle-down"></i>
                            </div>
                        </div>
                        <script type="module">
                            import { handleCryptoQuantityChange } from "./states/crypto-quantity.js";

                            handleCryptoQuantityChange((cryptoQuantity) => {
                                document.querySelector(
                                    "#crypto-quantity-select .crypto-control-btn-text"
                                ).innerHTML = cryptoQuantity;
                            });
                        </script>
                        <div
                            class="crypto-control-btn"
                            id="crypto-timeframe-select"
                        >
                            <div class="crypto-control-btn-text"></div>
                            <div class="crypto-control-arrow">
                                <i class="fas fa-angle-down"></i>
                            </div>
                        </div>
                        <script type="module">
                            import { handleCryptoTimeframeChange } from "./states/crypto-timeframe.js";

                            handleCryptoTimeframeChange((cryptoTimeframe) => {
                                document.querySelector(
                                    "#crypto-timeframe-select .crypto-control-btn-text"
                                ).innerHTML = `${cryptoTimeframe} %`;
                            });
                        </script>
                        <div class="search-crypto-btn">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                </div>
                <div class="crypto-table-wrapper">
                    <table class="crypto-list">
                        <thead class="crypto-list-header">
                            <tr>
                                <td class="crypto-list-header-number">#</td>
                                <td>
                                    Coin Price
                                    <span class="currency-header-label"
                                        >(USD)</span
                                    >
                                    <span class="sort-arrow">
                                        <i class="fas fa-sort"></i>
                                    </span>
                                </td>
                                <td class="crypto-list-header-percent">
                                    <span class="crypto-timeframe-val"></span> %
                                    <span class="sort-arrow">
                                        <i class="fas fa-sort"></i>
                                    </span>
                                </td>
                                <script type="module">
                                    import { handleCryptoTimeframeChange } from "./states/crypto-timeframe.js";

                                    handleCryptoTimeframeChange(
                                        (cryptoTimeframe) => {
                                            document.querySelector(
                                                ".crypto-list-header-percent .crypto-timeframe-val"
                                            ).innerHTML = cryptoTimeframe;
                                        }
                                    );
                                </script>
                                <td class="crypto-list-header-mcap">
                                    <span>Market Cap</span>
                                    <span class="sort-arrow">
                                        <i class="fas fa-sort"></i>
                                    </span>
                                </td>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div id="crypto-infinite-scroller"></div>
                </div>
                <script type="module">
                    import CryptoEntry from "./components/crypto-entry.js";
                    import {
                        getCryptoCoins,
                        getCryptoMetadata,
                        getCyptoTotalCount,
                    } from "./api/crypto.js";
                    import {
                        cryptoQuantity,
                        handleCryptoQuantityChange,
                    } from "./states/crypto-quantity.js";
                    import {
                        cryptoTimeframe,
                        handleCryptoTimeframeChange,
                    } from "./states/crypto-timeframe.js";
                    import { html } from "./utils/html.js";
                    import { onScrollTo } from "./utils/on-scroll-to.js";

                    const tbody = document.querySelector(
                        ".crypto-list > tbody"
                    );

                    let coins = null;
                    let cryptoTotalCount = null;
                    let metadata = null;

                    handleCryptoQuantityChange(async () => {
                        coins = await getCryptoCoins({
                            quantity:
                                cryptoQuantity == "Top 100"
                                    ? 100
                                    : cryptoQuantity == "Top 200"
                                    ? 200
                                    : 100,
                        });

                        cryptoTotalCount = await getCyptoTotalCount();

                        metadata = await getCryptoMetadata({
                            coinIds: coins.map((coin) => coin.id),
                        });

                        render();
                    });

                    handleCryptoTimeframeChange(() => {
                        render();
                    });

                    function render() {
                        if (!coins || !metadata) {
                            return;
                        }
                        tbody.innerHTML = "";
                        for (let i = 0; i < coins.length; i++) {
                            tbody.append(
                                CryptoEntry(
                                    i + 1,
                                    coins[i],
                                    metadata[coins[i].id],
                                    cryptoTimeframe
                                )
                            );
                        }

                        const scrollDetector = html(
                            `<div id="crypto-infinite-scroller" class="${
                                cryptoQuantity != "All Coins" ||
                                coins.length >= cryptoTotalCount
                                    ? "display-hidden"
                                    : ""
                            }">Loading...</div>`
                        );

                        onScrollTo(scrollDetector, async () => {
                            if (cryptoQuantity == "All Coins") {
                                coins = await getCryptoCoins({
                                    quantity: coins.length + 100,
                                });

                                cryptoTotalCount = await getCyptoTotalCount();

                                metadata = await getCryptoMetadata({
                                    coinIds: coins.map((coin) => coin.id),
                                });

                                render();
                            }
                        });
                        document
                            .querySelector(`#${scrollDetector.id}`)
                            .replaceWith(scrollDetector);
                    }
                </script>
            </div>
            <div id="stocks" class="display-hidden">
                <h1 class="main-title">Stocks</h1>
                <div class="stock-list">
                    <div class="stock-list-header">
                        <div>Name</div>
                        <div class="stock-list-header-price">
                            Price <span>(USD)</span>
                        </div>
                        <div class="stock-list-header-percent">% Change</div>
                    </div>

                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">AAPL</div>
                            <div class="stock-name-text">Apple Inc.</div>
                        </div>
                        <div class="stock-price">$175.43</div>
                        <div class="percent-change negative">
                            <span>-</span>1.08%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">GOOGL</div>
                            <div class="stock-name-text">Alphabet Inc.</div>
                        </div>
                        <div class="stock-price">$124.61</div>
                        <div class="percent-change negative">
                            <span>-</span>1.82%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">TSLA</div>
                            <div class="stock-name-text">Tesla, Inc.</div>
                        </div>
                        <div class="stock-price">$193.17</div>
                        <div class="percent-change positive">
                            <span>+</span>1.21%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">META</div>
                            <div class="stock-name-text">
                                Meta Platforms, Inc.
                            </div>
                        </div>
                        <div class="stock-price">$262.04</div>
                        <div class="percent-change negative">
                            <span>-</span>0.28%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">KO</div>
                            <div class="stock-name-text">
                                The Coca-Cola Company
                            </div>
                        </div>
                        <div class="stock-price">$60.26</div>
                        <div class="percent-change negative">
                            <span>-</span>1.89%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">PEP</div>
                            <div class="stock-name-text">PepsiCo, Inc.</div>
                        </div>
                        <div class="stock-price">$183.58</div>
                        <div class="percent-change positive">
                            <span>+</span>0.64%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">AMZN</div>
                            <div class="stock-name-text">Amazon.com, Inc.</div>
                        </div>
                        <div class="stock-price">$120.11</div>
                        <div class="percent-change positive">
                            <span>+</span>1.43%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">DE</div>
                            <div class="stock-name-text">Deere & Company</div>
                        </div>
                        <div class="stock-price">$351.21</div>
                        <div class="percent-change negative">
                            <span>-</span>0.23%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">BA</div>
                            <div class="stock-name-text">
                                The Boeing Company
                            </div>
                        </div>
                        <div class="stock-price">$203.63</div>
                        <div class="percent-change positive">
                            <span>+</span>1.93%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">SPY</div>
                            <div class="stock-name-text">
                                SPDR S&P 500 ETF Trust
                            </div>
                        </div>
                        <div class="stock-price">$420.02</div>
                        <div class="percent-change positive">
                            <span>+</span>1.50%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">QQQ</div>
                            <div class="stock-name-text">Invesco QQQ Trust</div>
                        </div>
                        <div class="stock-price">$348.40</div>
                        <div class="percent-change negative">
                            <span>-</span>0.21%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">IWM</div>
                            <div class="stock-name-text">
                                iShares Russell 2000 ETF
                            </div>
                        </div>
                        <div class="stock-price">$176.15</div>
                        <div class="percent-change negative">
                            <span>-</span>0.07%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">F</div>
                            <div class="stock-name-text">
                                Ford Motor Company
                            </div>
                        </div>
                        <div class="stock-price">$12.09</div>
                        <div class="percent-change positive">
                            <span>+</span>1.72%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">AMD</div>
                            <div class="stock-name-text">
                                Advanced Micro Devices, Inc.
                            </div>
                        </div>
                        <div class="stock-price">$127.03</div>
                        <div class="percent-change negative">
                            <span>-</span>0.97%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">NVDA</div>
                            <div class="stock-name-text">
                                NVIDIA Corporation
                            </div>
                        </div>
                        <div class="stock-price">$389.46</div>
                        <div class="percent-change positive">
                            <span>+</span>0.22%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">GS</div>
                            <div class="stock-name-text">
                                The Goldman Sachs Group, Inc.
                            </div>
                        </div>
                        <div class="stock-price">$332.01</div>
                        <div class="percent-change negative">
                            <span>-</span>2.01%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">UAL</div>
                            <div class="stock-name-text">
                                United Airlines Holdings, Inc.
                            </div>
                        </div>
                        <div class="stock-price">$47.26</div>
                        <div class="percent-change positive">
                            <span>+</span>0.90%
                        </div>
                    </div>
                    <div class="stock-entry">
                        <div class="stock-name">
                            <div class="stock-symbol">MCD</div>
                            <div class="stock-name-text">
                                McDonald's Corporation
                            </div>
                        </div>
                        <div class="stock-price">$286.04</div>
                        <div class="percent-change positive">
                            <span>+</span>1.63%
                        </div>
                    </div>
                </div>
            </div>
            <div id="crypto-timeframe-select-window"></div>
            <script type="module">
                import SelectWindow from "./components/select-window.js";
                import {
                    handleCryptoTimeframeChange,
                    cryptoTimeframe,
                    setCryptoTimeframe,
                } from "./states/crypto-timeframe.js";

                handleCryptoTimeframeChange(() => {
                    const newSelectWindow = SelectWindow({
                        title: "Price % Change Timeframe",
                        options: ["1h", "24h", "7d", "30d"],
                        selectedOpt: cryptoTimeframe,
                        onSelect: (opt) => {
                            // cryptoTimeframe = opt;
                            setCryptoTimeframe(opt);
                        },
                    });
                    newSelectWindow.id = "crypto-timeframe-select-window";

                    document
                        .querySelector(`#${newSelectWindow.id}`)
                        .replaceWith(newSelectWindow);
                });
            </script>
            <div id="crypto-quantity-select-window"></div>
            <script type="module">
                import SelectWindow from "./components/select-window.js";
                import {
                    handleCryptoQuantityChange,
                    cryptoQuantity,
                    setCryptoQuantity,
                } from "./states/crypto-quantity.js";

                handleCryptoQuantityChange(() => {
                    const newSelectWindow = SelectWindow({
                        title: "Coin Display Amount",
                        options: ["All Coins", "Top 100", "Top 200"],
                        selectedOpt: cryptoQuantity,
                        onSelect: (opt) => {
                            setCryptoQuantity(opt);
                        },
                    });
                    newSelectWindow.id = "crypto-quantity-select-window";

                    document
                        .querySelector(`#${newSelectWindow.id}`)
                        .replaceWith(newSelectWindow);
                });
            </script>
            <nav class="settings-window">
                <div>
                    <div class="drag-to-close">
                        <div class="drag-bar"></div>
                    </div>
                    <div class="settings-account-btns">
                        <button type="button">
                            <div>Log in</div>
                        </button>
                        <button type="button">
                            <div>Sign up</div>
                        </button>
                    </div>
                    <div class="settings-window-section">
                        <div class="settings-window-row">
                            <div class="settings-row-title">Dark Mode</div>
                        </div>
                        <div class="settings-window-row">
                            <div class="settings-row-title">
                                Default Currency
                            </div>
                            <div class="settings-row-content">
                                <div class="settings-row-value">$USD</div>
                                <!-- <div class="settings-row-arrow">
                                    <i class="fas fa-angle-right"></i>
                                </div> -->
                            </div>
                        </div>
                        <div class="settings-window-row">
                            <div class="settings-row-title">
                                Preferred Market
                            </div>
                            <div class="settings-pref-markets">
                                <div
                                    class="pref-market-opt selected-pref-market"
                                >
                                    Crypto
                                </div>
                                <div class="pref-market-opt">Stocks</div>
                            </div>
                        </div>
                    </div>
                    <div class="pref-market-detail-text">
                        The preferred market selects which one is displayed
                        initially.
                    </div>
                </div>
                <button type="button" class="settings-close-btn">Close</button>
            </nav>
            <script type="module">
                import { disableScrollBehind } from "./utils/disable-scroll-behind.js";

                disableScrollBehind(document.querySelector(".settings-window"));
            </script>
            <a id="back-to-top-btn" class="opacity-zero" href="#">
                <i class="fas fa-chevron-up"></i>
            </a>
        </main>
        <footer>
            <div class="footer-credits">
                All of the UI in this app is 100% completely designed &
                developed from scratch by <span>Amer Albareedi 😁</span>
            </div>
            <div class="footer-contacts">
                <a
                    href="https://albareedi.com/"
                    target="_blank"
                    class="footer-contact-btn"
                >
                    <i class="fa-solid fa-globe"></i>
                    <div>Portfolio</div>
                </a>
                <a
                    href="mailto:aalbareedi@yahoo.com"
                    class="footer-contact-btn"
                >
                    <i class="fa-solid fa-envelope"></i>
                    <div>Email</div>
                </a>
                <a
                    href="https://github.com/aalbareedi"
                    target="_blank"
                    class="footer-contact-btn"
                >
                    <i class="fab fa-github"></i>
                    <div>GitHub</div>
                </a>
            </div>
        </footer>
        <script src="script.js" defer type="module"></script>
        <script src="carousel/carousel.js" defer type="module"></script>
    </body>
</html>
